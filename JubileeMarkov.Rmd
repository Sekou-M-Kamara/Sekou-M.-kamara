---
title: "Understanding Long-Term Share Price Behavior of Jubilee Holdings Limited on the Kenya Securities Exchange: A Markov Model Approach complemented by Ergodic Stationarity"
author: "Sekou Mohammed Kamara"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{xcolor}
  - \usepackage{tikz}
  - \usetikzlibrary{arrows.meta, positioning}
---

# Abstract

This paper examines the long-term behavior of Jubilee Holdings Limited's share price using a Markov model to describe transitions and the concept of ergodic stationarity to analyze increments. The Markov model results show long-term probabilities of **31.2% for upward transitions**, **30% for downward transitions**, and **38.8% for no change**. Increment analysis suggests that the ensemble mean is zero, as supported by the Z-test, indicating no drift in the share price increments.

These results imply that the share price exhibits stability over the long term, with no tendency for sustained directional movement. While this analysis pertains specifically to capital gains, the paper notes Jubilee Holdings Limited’s consistent dividend payments as a consideration for income-focused investors.

------------------------------------------------------------------------

# Introduction

Equity investment plays a pivotal role in driving economic growth as it serves as a major source of cash flow for businesses. A country's productivity is intrinsically linked to the productive capacity of the businesses operating within it. Equity markets facilitate this by enabling companies to raise capital through mechanisms such as Initial Public Offerings (IPOs) and Secondary Public Offerings (SPOs). Share prices serve as a critical indicator for evaluating firm-specific performance, while an index of share prices reflects the general economic outlook of a country, assuming market efficiency. Notable examples include the Nairobi Securities Exchange All-Share Index (NASI) and the S&P 500 of the New York Stock Exchange (NYSE).

For an investor, the return from buying shares is derived from two components: dividend payments and capital gains. The realization of capital gains, however, is contingent upon the behavior of share prices, which are influenced by company performance and broader market dynamics. This underscores the importance of predicting share price behavior to inform investment decisions. While it is impossible to predict share prices with certainty, statistical and probabilistic models can reduce uncertainty by forecasting the direction of movement with lesser degrees of error. Various methodologies, including neural networks, data mining, moving averages, regression analysis, Autoregressive Integrated Moving Average (ARIMA) models, and Markov Chain analysis, have been employed to analyze stock market trends (Odinga, 2015, p. 14713). Each of these models has unique strengths and limitations, and the choice of model depends on how well it fits the data.

The Kenyan stock market, particularly the Nairobi Securities Exchange (NSE), has witnessed increased investor confidence following favorable economic conditions, such as the end of post-election violence in 2008 and the peaceful general elections of 2013. Daily stock price movements in Kenya are influenced by a range of factors, including political forces, fuel prices, exchange rates, inflation, dividend announcements, and the introduction of new products (Kiplangat, 2024, p. 1529). These factors create a dynamic environment that necessitates robust modelling approaches to analyze and predict share price trends.

Jubilee Holdings Limited (JHL) provides an excellent case study for such an analysis. Founded in 1937 as the first incorporated insurance company in Mombasa, JHL has grown into the leading regional composite insurer. It is listed on three stock exchanges: the Nairobi Securities Exchange, the Dar-es-Salaam Stock Exchange, and the Uganda Securities Exchange. JHL’s consistent performance, particularly in dividend payments and delivering shareholder value, has made it a favorable investment option among Kenyan investors. As the parent company of Jubilee Insurance, a major player in Kenya’s insurance sector, its share price behavior offers valuable insights into potential capital gains and losses.

This paper aims to comprehensively describe the long-term behavior of Jubilee Holdings Limited’s share price using a Markov model in conjunction with the concept of ergodic stationarity. The Markov model is employed to analyze the probability distribution of share price transitions, while the concept of ergodic stationarity addresses its limitations. Although Markov models excel at identifying the relative frequency of transitions, they do not account for the magnitude of those transitions. For example, a share price may increase more frequently than it decreases, but if the magnitude of the decreases outweighs the increases, the overall trend may still be bearish. Relying solely on the Markov model could lead to misleading inferences in such cases.

To overcome this limitation, this study incorporates the concept of ergodic stationarity to estimate the ensemble mean (drift in increments). Geometric Brownian Motion (GBM) could be used to model the magnitude of transitions, but the share price increments exhibit significant first order autocorrelation, which violates the assumption of independence associated with the GBM. This will be shown later in this paper.

In short, this study leverages a combination of the Markov model and ergodic stationarity concepts to analyze the share price behavior of Jubilee Holdings Limited. By addressing the limitations of traditional Markov models, it provides a more accurate and nuanced understanding of the long-term trends in JHL’s share price, offering insights for both academic research and investment decision-making.

------------------------------------------------------------------------

# Concepts employed in this text

## **stochastic process**

A **stochastic process** refers to a collection of random variables indexed by time, or a process that evolves randomly over time, denoted mathematically as $\{X_t\}_{t \geq 0}$, where $t$ represents time. The values of a stochastic process can vary unpredictably over time, embodying the randomness inherent in the process. Examples include the price of a company’s share over time, the temperature of a region over time, or a company’s revenue over time. A stochastic process has two main features: state space and time domain. The nature of these features is used to classify a stochastic process.

**State Space**

The state space, usually denoted as $\mathbf{S}$ where $\mathbf{S} \subseteq \mathbb{R}$ , is the set of possible values or states that the process can occupy at a given point in time. A state space can be either discrete or continuous. A discrete state space takes on specific values within a numerical interval or can be a finite set of non-numerical elements. For example, a counting process has a discrete state space represented as $\mathbf{S} = \{0, 1, 2, 3, \dots\}$. Conversely, a continuous state space can take any value within a specified interval, such as $\mathbf{S} = [0, \infty)$. A good example is the price of a share.

**Time Domain**

The time domain, denoted as $\mathbf{T}$ where $\mathbf{T} \subseteq \mathbb{R}$, refers to the set of time points over which the process evolves. Like the state space, the time domain can also be discrete ($\mathbf{T} = \{0, 1, 2, 3, \dots\}$) or continuous ($\mathbf{T} = [0, \infty)$). The time domain usually starts from 0, indicating the start of the process.

**Autocorrelation**

Many real-world data exhibit auto-correlations, which quantifies the relationship between the future and past of a stochastic process. Autocorrelation measures the degree of dependency between $X_{t-1}$ and $X_t$ for all values of $t \in \mathbf{T}, \; t \in \mathbb{R}$. This relationship is fundamental to building forecasts of a stochastic process.

**Stationarity**

Stationarity is a unique characteristic of a time series (stochastic process). There are two types of stationarity:

1.  Strong Stationarity: The joint distribution of the process is invariant under time shifts, denoted as $F(X_{t_1+k}, X_{t_2+k}, \dots, X_{t_n+k}) = F(X_{t_1}, X_{t_2}, \dots, X_{t_n})$ for all values of $t, k \in \mathbb{R}$. This form of stationarity is often too strict for real-world processes.

2.  Weak Stationarity: A process is weakly stationary if its mean and variance are constant over time, and its autocovariance depends only on the time lag (difference in time) and not on specific time points. Mathematically: $E(X_t) = \mu$, and the $\text{Var}(X_t) = \sigma$, for all value of $t \in \mathbb{R}$, and the $\text{Cov}(X_t, X_{t+k}) = f(k)$, where lag $k \in \mathbb{R}$.

When I refer to stationarity in this text, I mean weak stationarity. Real-world processes are rarely perfectly stationary, but with adjustments (as discussed in this text), we can approximate stationarity for practical analysis. A time series is considered stationary if it obeys the properties mentioned above.

**Ensemble Mean**

The ensemble mean is the expected value of the process at a given time . If we had all possible sample paths (the population of paths) at time t, the average of the values yielded by each sample path would be the ensemble mean. It is denoted as:

$$
A_t = \frac{1}{N} \left( \sum_{k = 1}^{N} z_k \right)
$$

where $z_k$ is the value yielded by the $\text{k-th}$ sample path, and $A_t$ is the population mean of $X_t$ for $t \in \mathbb{R}$. A similar approach can be applied to compute the **ensemble variance**.

It is impossible to calculate the population mean because we only observe a single realization of the process. This limitation leads to the challenge of finding an unbiased estimate.

**Time Average**

The **time average** is the mean of all values in a single realized path, typically used to estimate the ensemble mean. However, this approach assumes ergodicity.

**Ergodicity** is a fundamental property in time series analysis, particularly in stochastic processes. It ensures that the statistical properties of a process can be inferred from a single realization of the series over time. For a process to be ergodic, it must satisfy two key conditions:

1.  The process must be stationary.

2.  The autocorrelation between variables should diminish and eventually become statistically insignificant as the lag increases. Formally, this is expressed as:

    $$
    \text{Cov}(X_t, X_{t+k}) \to 0 \quad \text{as} \quad k \to \infty.
    $$

The **time average** is given by:

$$
\bar{X}_t = \frac{1}{n} \sum_{t=1}^{n} X_t, \quad t \in \mathbb{R}.
$$

where $n$ is the number of observations.

A similar approach can be applied to compute the **time variance**.

Under this property, the law of large numbers can hold, as the process exhibits weak autocorrelation and approximates independence over large lags.

**Law of Large Numbers (LLN)**

The LLN assumes that a random sample consists of independent and identically distributed (IID) random variables. Under this assumption, sample statistics converge to population parameters ($\bar{x} \to \mu$, $s^2 \to \sigma$, $\text{as}\; n \to \infty$) as the sample size increases. Ergodicity extends this property to stationary processes, even when the variables are not IID, as long as autocorrelation diminishes with increasing lag. Note that not all stationary processes are ergodic, but an ergodic process is stationary by default.

**Why Time Averages Are Unbiased**

The time average of a process is computed as:

$$
\bar{X}_t = \frac{1}{n} \sum_{t=1}^{n} X_t
$$

The expectation of the time average is:

$$
E(\bar{X}_t) = \frac{1}{n} \sum_{t=1}^{n} E(X_t)
$$

However, since $E(X_t)$ for $t = \{1, 2, 3, \dots, n\}$ are the same for a stationary process, the time average thus provide an unbiased estimate for the ensemble mean as:

$$
E(X_t) = \frac{n\times\mu}{n}
$$

$$
E(X_t) = \mu \quad \text{for all values of} \ t \in \mathbb{R}.
$$

**Behavior of an Ergodic Stationary Process**

An ergodic stationary process exhibits several useful behaviors:

-   The ensemble mean is the same across all variables in the process.
-   Due to weak autocorrelation and long-term independence, the process converges to its ensemble mean over time.
-   This convergence results in high concentration and symmetric movement around the mean, allowing for drift analysis. For instance, if increments in the process consistently move in one direction, it may indicate a drift.

These characteristics enable us to analyze share price increments and detect trends effectively.

## **Markov Chains**

A Markov chain is a specific type of stochastic process characterized by a discrete time domain and a finite state space. A process satisfies the Markov property if the future state of the process depends only on the present state and not on its past states, given the history of the process. Mathematically, this property is represented as$$
P(X_t = j \mid X_1 = i_1, X_2 = i_2, \dots, X_{n-1} = i_{n-1}, X_n = i_n) = P(X_t = j \mid X_n = i_n), \quad \text{where} \,\ n,t \in \mathbf{T}, \quad n \in \mathbb{R}, \quad n < t.
$$

**Transition Frequency**

The transition frequency represents the count of how many times the process transitions from one state $i$ to another state $j$. It is denoted as $N_{ij}$, where $i, j \in \mathbf{S}$. Additionally, the total frequency of transition $N_i$ accounts for the number of times the process has transitioned from a specific state $i$, which is a subset of the state space. When these frequencies are derived from a sample, they are denoted $n_{ij}$ and $n_i$ respectively. These sample frequencies ($n_{ij}$, $n_i$) are essential for empirically estimating transition probabilities in a Markov chain.

**Transition Probabilities**

Transition probabilities are key features of a Markov chain. They represent the conditional probabilities that the chain transitions from one state to another. Represented as: $P_{ij}^{(n, \,n+k)} \geq 0$, where $i, j \in \mathbf{S}$ and $n, (n+k) \in \mathbf{T}$, indicating the probability of moving from state $i$ at time $n$ to state $j$ at time $(n+k)$.

For a time-homogeneous Markov chain, the one-step transition probability, which is most relevant, can be calculated as: $P_{ij} = \frac{N_{ij}}{N_i}$. When using sample data, the estimate of the one-step transition probability is computed as: $\hat{P}_{ij} = \frac{n_{ij}}{n_i}$.

**Transition Matrix**

The transition matrix, denoted as $\mathbf{P}$, is a matrix where each entry represents a transition probability. Each row corresponds to a transition probability distribution, given the process is in a specific state. This ensures that each row sums to $1$. The transition matrix is a square matrix with dimensions $m\times m$, where $m$ is the cardinality of the state space. It is represented as:

$$
\mathbf{P} =
\begin{pmatrix}
P_{11} & P_{12} & \cdots & P_{1m} \\
P_{21} & P_{22} & \cdots & P_{2m} \\
\vdots & \vdots & \ddots & \vdots \\
P_{m1} & P_{m2} & \cdots & P_{mm}
\end{pmatrix}
$$

**Order of the Transition Matrix**

The transition matrix can describe transitions over different steps. A one-step transition matrix contains the probabilities of transitioning to another state in a single step. An n-steps transition matrix extends this concept, providing probabilities for transitions over n-steps. It is generally represented as:

$$
\mathbf{P^n} =
\left(\begin{pmatrix}
P_{11} & P_{12} & \cdots & P_{1m} \\
P_{21} & P_{22} & \cdots & P_{2m} \\
\vdots & \vdots & \ddots & \vdots \\
P_{m1} & P_{m2} & \cdots & P_{mm}
\end{pmatrix}\right)^n
$$

where $n$ represents the number of steps.

**Initial Probability Distribution**

The initial probability distribution represents the probabilities associated with the initial state of the process. It is denoted as: $\pi = (\pi_1, \pi_2, \dots, \pi_n)$, where $\pi_r$ for $r = (1, 2,..., n)$ is the probability of the process starting in the $r\text{-}th$ state.

**Types of Markov Chains**

Markov chains can also be classified based on the time-dependence of their transition probabilities:

-   Time-homogeneous: Transition probabilities are independent of time: $P_{ij}^{(n, \,n+k)} = P_{ij}$, where $i, j \in \mathbf{S}$ and $n, (n+k) \in \mathbf{T}$.
-   Time-inhomogeneous: Transition probabilities depend on time: $P_{ij}^{n, \,n+k)} \neq P_{ij}$, where $i, j \in \mathbf{S}$ and $n, (n+k) \in \mathbf{T}$.

In this paper, a time-homogeneous Markov chain is used to model transitions. Any reference to a Markov chain implies a time-homogeneous Markov chain.

**Defining a Markov Model**

A Markov model is defined by its initial probability distribution and one-step transition matrix. These two elements are sufficient to describe the entire behavior of the chain and derive any other probability distributions of the process.

**Stationary Probability Distribution**

The stationary probability distribution describes the long-term behavior of the process. For a Markov model, the unconditional probability distribution indexed by time converges to a stationary distribution, providing insights into the process’s long-term behavior. It is denoted as:

$$
\pi = \pi \mathbf{P}, \quad \text{where } \pi \text{ is a row vector of the stationary probabilities.}
$$

$$
\pi_j = \sum_{i \in \mathbf{S}} \pi_i P_{ij}, \quad \text{where } \pi_j \in \pi.
$$

$$
\pi_j \geq 0, \quad \sum_{i \in \mathbf{S}} \pi_i = 1.
$$

Not all Markov chains achieve a stationary distribution. For a Markov chain to reach its stationary distribution, it must be irreducible and aperiodic (defined below).

**Behavior of States in a Markov Chain**

Different states exhibit different behaviors in a Markov chain. Understanding these behaviors is crucial for interpreting the underlying stochastic process. Key behaviors include:

Irreducible Chain: All states communicate, meaning it is possible to reach any state from any other state with non-zero probability. $\left(P_{ij}^{(n, n+k)} > 0 \, \text{where } i, j \in \mathbf{S} \text{ and } n, n+k \in \mathbb{R}\right)$

Aperiodic State: A state is aperiodic if the number of steps required to return to it has the greatest common divisor of 1. This prevents the chain from being trapped in a periodic cycle. A Markov chain made entirely of aperiodic states is aperiodic as well.

Absorbing State: Once the process enters this state, it remains there indefinitely.$(P_{ij} = 0, \, \text{for all } i, j \in \mathbf{S}\quad \text{ if } i \text{ is an absorbing state})$.

Transient State: A state is transient if, after leaving, there is a non-zero probability of never returning to it. $(P_{ij} = 0 \text{ for some } i \in S)$

Recurrent State: A state is recurrent if, after leaving, the probability of eventually returning to it is $1$. $(P_{ij} > 0, \text{ for all } i \in \mathbf{S} \text{ where } j \text{ is a transient state})$.

## Jubilee-code

To ensure complete control over the analytical process, all computations, tables, and visualizations in this study were conducted using a custom-developed codebase named *Jubilee-code*. This bespoke code was specifically designed to perform the Markov chain analysis, and other statistical methods applied to the share price data.

The use of *Jubilee-code* allowed the computational workflows to be tailored to the specific requirements of this study, ensuring precision, transparency, and adaptability in data analysis. This approach also facilitated a deeper understanding of the underlying processes while minimizing dependence on external tools or prebuilt software packages. [This is the link to Jubilee-code on my Github.](https://github.com/Sekou-M-Kamara/Sekou-M.-kamara/blob/main/Jubilee-code.R)

------------------------------------------------------------------------

# Case study

The focus of this study is Jubilee Holdings Limited (JHL), a company listed on the Kenya Securities Exchange. The objective was to model JHL's share price behavior to forecast its long-run dynamics. The share price was analyzed in two distinct forms:

1.  ***Markov Chain Transition Model***\
    First, the transition distribution of the share price was modeled using a Markov chain. This model provided insights into the frequency of price changes and, when changes occurred, how often the price moved up, down, or remained unchanged. The state space is consisted of three states: *Up*, *Down*, and *No-change*. The Markov chain used to model the share price is irreducible and aperiodic.

    -   For instance, if the share price was 150 yesterday and increased to 160 today, it was categorized in the *Up* state.

    -   If tomorrow's price decreases to 140, it transitions to the *Down* state.

    -   If the price remains constant, it is classified in the *No-change* state.

Below is the transitions diagram:

\begin{center}
\begin{tikzpicture}[
  node distance=3cm, 
  every node/.style={circle, draw, minimum size=1.5cm}, 
  >=Stealth
]

% Nodes
\node (A) at (0, 0) {Down};
\node (B) at (3, 3) {Up};
\node (C) at (6, 0) {No-change};

% Arrows between states
\draw[->, thick] (A) -- (B);
\draw[->, thick] (B) -- (C);
\draw[->, thick] (C) -- (A);

\draw[->, thick] (B) -- (A);
\draw[->, thick] (C) -- (B);
\draw[->, thick] (A) -- (C);

% Self-loops
\draw[->, thick, loop left] (A) to (A);
\draw[->, thick, loop above] (B) to (B);
\draw[->, thick, loop right] (C) to (C);

\end{tikzpicture}
\end{center}

2.  ***Drift Analysis***\
    To complement the Markov chain model and address its limitation of not accounting for the magnitude of price changes, the second part of the study analyzed the drift in the share price increments. This was achieved by leveraging the concept of ergodic stationarity, as the first differences (increments) in the share price exhibit this property.

**Data Collection**

\
The data for this study was sourced from the official Jubilee Holdings Limited website, ensuring its credibility and quality. It consisted of daily closing prices from January 1, 2010, to December 24, 2024, spanning 3,732 observations. The 3,731 states were derived from the changes in share prices, categorized using a customized tool, ***Jubilee-code***.

## **Creation of the Markov model**

State space ($\mathbf{S}$) = $\{\text{"Up(u)"}, \text{"Down(d)"}, \text{"No-change(g)"}\}$

Time domain ($\mathbf{T}$) = $\{1, 2, 3, \dots, \infty\}$

```{r, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}

# Data preparation --------------------------------------------------------

library(readxl)
JUB <- read_excel("C:/Jubilee_Insurance_Markov/JUB.xlsx")

order_data <- function(stock_data){
  ordered_data <- c()
  pointer <- length(stock_data)
  while(length(stock_data) > length(ordered_data)){
    ordered_data <- c(ordered_data,stock_data[pointer])
    pointer = pointer - 1
  }
  
  return(ordered_data)
}

jub_data <-  order_data(JUB$Closing)

# Transition analysis -----------------------------------------------------

generate_state_sequence <- function(transition_data){
  pointer <- 1
  stateVec <- c()
  for(i in transition_data){
    pointer = pointer + 1
    if(length(transition_data) != (pointer -  1)){
      if(i > transition_data[pointer]){
        stateVec =  c(stateVec, "Down")
      } else if(i < transition_data[pointer]){
        stateVec =  c(stateVec, "Up")
      }else{
        stateVec = c(stateVec, "No-change")
      }
    }
  }
  
  return(stateVec)
}

states_seq <- generate_state_sequence(jub_data)
states <- c("Up", "Down", "No-change")


#_____________________________________________________________________________

transition_matrix <- function(states, transition_data, conv.num = 10){
  
  transition_list <- vector("list", length = length(states))
  transition_list_2 <- vector("list", length = length(states))
  total_transitions <- numeric(length = length(states))
  names(transition_list) <- states
  names(transition_list_2) <- states
  
  for(name in states){
    pointer <- 1
    next_states  <- c()
    for(j in transition_data){
      pointer = pointer + 1
      if(name == j & length(transition_data) != pointer -1){
        next_states  <- c(next_states , transition_data[pointer])
      }
    }
    transition_list[[name]] <- t(as.matrix(prop.table(table(factor(next_states ,  levels = states)))))
    transition_list_2[[name]] <- t(as.matrix(table(factor(next_states ,  levels = states))))
   
    
  }
  transition_matrix <- matrix(0, ncol = length(states), byrow = TRUE)
  transition_count <- matrix(0, ncol = length(states), byrow = TRUE)
  
  pointer <- 1
  for(name in states){
    transition_matrix <- rbind(transition_matrix, transition_list[[name]])
    transition_count <- rbind(transition_count, transition_list_2[[name]])
    total_transitions[pointer] <-  sum(transition_list_2[[name]])
    pointer = pointer + 1
  }
  transition_matrix <- transition_matrix[-1,]
  rownames(transition_matrix) = states
  colnames(transition_matrix) = states
  
  transition_count <- transition_count[-1,]
  transition_count <- cbind(transition_count, total_transitions)
  rownames(transition_count) = states
  colnames(transition_count) = c(states, "Total_transition")
  
  for(name in  states){
    if(sum(transition_matrix[name,]) != 1){
      stop("Transition matris rows not adding up ton one")
    }
  }
  
#_____  
  longterm_dist <- function(tran_matrix){
    
    identity_mat <- numeric(length = ncol(tran_matrix)**2)
    pointer <- 0
    for (i in 1:ncol(tran_matrix)) {
      identity_mat[i+pointer] = 1
      pointer = pointer + ncol(tran_matrix)
    }
    identity_mat <- matrix(identity_mat, ncol = ncol(tran_matrix), byrow = TRUE)
    
    out_vec <- numeric(length = ncol(tran_matrix))
    add_row <- numeric(length = ncol(tran_matrix))
    
    out_vec[ncol(tran_matrix)] =  1
    add_row[1:ncol(tran_matrix)] = 1
    
    coef_matrix  <-  rbind((t(tran_matrix)-identity_mat)[-1,],add_row)
    long_dist <- solve(coef_matrix, out_vec)
    
    return(long_dist)
  }
  
  stationary_dist <- longterm_dist(transition_matrix)
  initial_dist <- t(as.matrix(prop.table(table(factor(transition_data ,  levels = states)))))
  
#_____
  library(expm)
  convergence_table <-  matrix(0, ncol = length(states), byrow = TRUE)
  names(convergence_table) <- states
  steps <- c()
    for(i in 1:conv.num){
      conv_mat <- initial_dist %*% (transition_matrix %^% i)
      convergence_table <- rbind(convergence_table, conv_mat)
      steps[i] <- i
    }
  convergence_table <- convergence_table[-1,]
  convergence_table <-  cbind(convergence_table, steps)
  colnames(convergence_table) <- c(states, "Day(s)_from_now")
  
  transition_count <- round(transition_count, 3)
  transition_matrix <- round(transition_matrix, 3)
  stationary_dist <- round(stationary_dist, 3)
  initial_dist <- round(initial_dist, 3)
  convergence_table <-  round(convergence_table, 3)
  
  return(list(transition_count, transition_matrix, stationary_dist, initial_dist, convergence_table))
}

tran_matrix <- transition_matrix(states, states_seq, conv.num = 10)
library(knitr)
kable(tran_matrix[[1]], caption = "Transitions Frequency", label = "Table 1")
kable(tran_matrix[[2]], caption = "Transition Matrix", label = "Table 2")
```

> ***Table 1: Transition Frequencies (***$n_{ij}$***)***\
> Table 1 displays the transition frequencies, denoted as $n_{ij}$, which represent the number of times the process transitions from one state $i$ to another state $j$. Each entry in the table reflects how many times this transition occurred over the studied period. For instance, the entry in the first row and second column ($n_{ud}$) indicates that Jubilee Holding Ltd's share price transitioned $488$ times from the "Up" state to the "Down" state between January 1, 2010, and December 24, 2024 out of the $1163$ (row total) times it transitioned from the "Up" state.

> ***Table 2: Transition Probabilities (***$P_{ij}$***)***\
> Table 2 presents the transition probabilities, denoted as $P_{ij}$, which are calculated as the relative frequencies of transitions from state $i$ to state $j$. These probabilities are derived by dividing each transition frequency ($n_{ij}$) by the total number of transitions originating from state $i$. In simpler terms, the entries in Table 2 show the likelihood of the share price moving from one state to another.
>
> For example, the entry in the first row and second column ($P_{ud}$) indicates that **42% of the times** when the share price transitioned from the "Up" state, it transitioned to the "Down" state. This helps to quantify the tendencies in share price movements.

***Initial probability distribution***

The live share price of JHL on the Nairobi Securities Exchange allows us to observe the current state directly. In such cases, the initial probability distribution is defined as:

$$
\left[(1, 0, 0), (0, 1, 0), (0, 0, 1)\right],
$$

indicating that the price will be in one of the states when observed. However, if you opt not to check the current state of the process (since it changes constantly), the general initial probability distribution can be calculated using the relative frequency of the number of times each state was visited ($t_j$) over the studied period.

For $j \in \mathbf{S}$, the formula for general initial probabilities is:

$$
\hat{\pi}_j = \frac{t_j}{t}, \quad \text{where} \; t \; \text{here is the total number of states that make up the process}.
$$Here:

$$
t_j = (t_u, t_d, t_g), \quad \hat{\pi} = (P_u, P_d, P_g)
$$

with the observed values:

$$
t_j = (1163, 1120, 1448), \quad n = 3731
$$

From these values, the initial probability distribution is computed as:

$$
\hat{\pi} = \left(\frac{1163}{3731}, \frac{1120}{3731}, \frac{1448}{3731}\right) = (0.312, 0.300, 0.388)
$$

Thus, the initial probability distribution is:

$$
\hat{\pi} = (0.312, 0.300, 0.388)
$$

***Accessing the fit ( Triplets test)***

To use the Markov model, we need to ensure that the process satisfies the Markov property. One of the tests used is the triplet test, which has a chi-square statistic:

$$
X^2 = \sum_{i,j,k} \frac{N_{ijk} - N_{ij} P_{jk}}{N_{ij} P_{jk}}, \quad \text{where } i, j, k \in \mathbf{S}, \quad \text{df} = m^3 - m, \quad \text{where } m \text{ is the cardinality of the state space.}
$$

The idea is that $N_{jk} \sim \text{Binomial}(N_j, P_{jk})$, where $N_j$ is the number of times the process transitions from state $j$. If the process is Markovian, then $N_{ijk} \sim \text{Binomial}(N_{ij}, P_{jk})$, where $N_{ij}$ is the number of times the process transitions from state $i$ to $j$, and then to another state. In other words, if the process is Markovian, then given a transition from state $i$ to $j$, the probability of transitioning to state $k$ should be described by $P_{jk}$​, that is $P_{ijk} = P_{jk}$.

This can be expressed as:

$$
P(X_{t+3} = k \mid X_{t+1} = i, X_{t+2} = j) = P(X_{t+3} = k \mid X_{t+2} = j)
$$

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
transition_fit_dataframe <- function(states, transition_data, tran_matrix){
  
  transition_names <- numeric(length = length(states)**2)
  pointer  <- 1
  for(name_one in states){
    for(name_two in states){
      transition_names[pointer] <- paste0(name_one, name_two)
      pointer = pointer + 1
    }
  }
  
  total_transitions <- numeric(length = length(states)**2)
  transition_list <- vector("list", length = length(states)**2)
  names(transition_list) <- transition_names
  
  for(name_one in states){
    for (name_two in states) {
      pointer <- 2
      next_states  <- c()
      for(j in 2:length(transition_data)){
        pointer = pointer + 1
        if(transition_data[j-1] == name_one & transition_data[j] == name_two & length(transition_data) != (pointer - 1)){
          next_states  <- c(next_states , transition_data[pointer])
        }
      }
      transition_list[[paste0(name_one,name_two)]] = t(as.matrix(table(factor(next_states ,  levels = states))))
    }
  }
  transition_count <- matrix(0, ncol = length(states), byrow = TRUE)
  colnames(transition_count) = states
  
  pointer <- 1
  for(name in transition_names){
    transition_count <- rbind(transition_count, transition_list[[name]])
    total_transitions[pointer] <-  sum(transition_list[[name]])
    pointer = pointer + 1
  }
  transition_count <- transition_count[-1,]
  
  expected_freq <- c()
  pointer <- 1
  for(i in 1:(length(states)**2)){
    if(pointer > length(states)){
      pointer <- 1
    }
    expected_freq <- c(expected_freq, total_transitions[i] * tran_matrix[states[pointer],])
    pointer = pointer + 1
  }
  expected_matrix <- matrix(expected_freq, ncol = length(states), byrow = TRUE)
  
  expected_names <- c()
  for(i in 1:length(states)){
    expected_names[i] = paste0("Expected-", states[i]) 
  }
  
  transition_count <- cbind(transition_count,expected_matrix,total_transitions)
  rownames(transition_count) = transition_names
  colnames(transition_count) = c(states,expected_names,"Total_transition")
  transition_count <- transition_count
  
   return(transition_count)
  
}

triple <- transition_fit_dataframe(states, states_seq, tran_matrix[[2]])
library(knitr)
kable(triple, caption = "Observed and Expected Frequencies", label = "Table 3")
```

> Table 3 presents the observed and expected frequencies of transitions between the three states $\left(i,j,k\right)$, where $i,j,k \in \mathbf{S}$. For example, the entry in the first row and first column indicates that there were $92$ observed transitions from "Up" to "Up" to "Up," while the entry in the first row and fourth column indicates that we expected $85.952$ transitions. The purpose of this triplet test is to assess whether the difference between the observed and expected frequencies is statistically significant.

\textcolor{red}{Test outputs}

> **Null Hypothesis**: The data fit the Markov model.
>
> **Alternative Hypothesis**: The data do not fit the Markov model.
>
> -   **P-value**: 0.572
>
> -   **Chi-square statistic**: 22.125
>
> -   **Chi-square critical value**: 36.415
>
> **Test result**: Since the P-value (0.572) is greater than the significance level (typically 0.05), we fail to reject the null hypothesis. This suggests that there is no significant evidence to conclude that the data do not fit the Markov model.

***Stationary distribution***\

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
kable(tran_matrix[[3]], caption = "Long-term Distribution", label = "Table 4")
```

> Table 4 presents the long-term distribution of Jubilee Insurance share prices. From the table, we can infer that in the long run, there is a 31.2% chance of the share price going up, a 30% chance of the price going down, and a 38%, which reflects the low volume of transactions on the Nairobi Securities Exchange, chance of the price remaining the same.

\textcolor{red}{Note:} As we can see, the general initial distribution and the stationary distribution are exactly the same, which is quite interesting. This tells us that the share price has an unconditional stationary distribution, even from the initial state at $t=0$.

**Discussion (Markov Model)**

Interestingly, the unconditional distribution of the share price remains stationary throughout its progression. This means that $P(X_t = x_t)$ is the same for all values of $t \in \mathbf{T}$. Another observation is that there is no significant difference between the probability of the share price going up ($P_d = 0.312$) and the probability of it going down ($P_d = 0.312$). Furthermore, the fact that there is a $38.8\%$ chance of the price remaining unchanged reflects a low level of market activity. This aligns with the low liquidity typically associated with the Nairobi Securities Exchange, which reflects its status as an emerging market.

Below is the distribution of values obtained at the end of $2000$ simulated paths, each spanning $2000$ days from today, assuming the share price today is $\text{KSH}\; 0$ and the magnitude of change is constant, let’s say $\text{KSH}\; 1$. The algorithm used for the simulation is from **Jubilee-code**. It started with the general initial probability distribution to determine the initial state and then computed all subsequent states based on the conditional distribution corresponding to the rows of the transition matrix. This approach ensures that the dependency in the transitions is accounted for.

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
simulate_markov <- function(tran_matrix, init_dist, states, n_steps = 1000, plot = FALSE){
  cumulative_vec <- sample(states, 1, prob = init_dist)
  for(i in 1:n_steps){
    for(name in states){
      if(cumulative_vec[i] == name){
        cumulative_vec <-  c(cumulative_vec, sample(states, 1, prob = tran_matrix[name,]))
      }
    }
  }
  
cumulative_vec <- cumulative_vec[-1]
cumulative_vec[cumulative_vec ==  "Up"] =  1
cumulative_vec[cumulative_vec ==  "Down"] =  -1
cumulative_vec[cumulative_vec ==  "No-change"] =  0
cumulative_vec <- as.integer(cumulative_vec)
cumulative_vec <- cumsum(as.integer(cumulative_vec)) 
  

# plot(seq(0, n_steps-1, 1),cumulative_vec, type = "s", col = "brown", xlab = "Steps", ylab = "Positions")
return(cumulative_vec[n_steps])

}

ensembled_dist <- c()
for(i in 1:2000){
  ensembled_dist <- c(ensembled_dist, simulate_markov(tran_matrix[[2]], tran_matrix[[4]], states))
  i = i + 1
}

generate_returns_dist <- function(stock_increments){
  increments <- stock_increments
  
  #Freedman-Diaconis rule
  bin_width <- 2 * (IQR(increments)/(length(increments))**(1/3))
  number_bins <- (range(increments)[2] - range(increments)[1])/bin_width
  number_bins <-  ceiling(number_bins)
  
  hist(increments, breaks = number_bins, xlim = c(min(increments),max(increments)), xlab = "Ensemble Values", main = "Distribution of Ensemble Values After Simulation")
}
generate_returns_dist(ensembled_dist)
```

> The ensemble of values from the simulated paths exhibits a symmetrical bell-shaped structure, indicating that it follows a normal distribution. The simulated data has a mean of $11.717$ and a standard deviation of $20.20082$. Assuming that the constant magnitude of change holds—though this assumption would not strictly hold in real-world scenarios—there is a $70.9\%$ chance of an investor benefiting from capital gains and a $29.1\%$ chance of incurring capital losses.
>
> Below are five of the simulated paths:

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
simulate_markov <- function(tran_matrix, init_dist, states, n_steps = 100, plot = FALSE){
  cumulative_vec <- sample(states, 1, prob = init_dist)
  for(i in 1:n_steps){
    for(name in states){
      if(cumulative_vec[i] == name){
        cumulative_vec <-  c(cumulative_vec, sample(states, 1, prob = tran_matrix[name,]))
      }
    }
  }
  
cumulative_vec[cumulative_vec ==  "Up"] =  1
cumulative_vec[cumulative_vec ==  "Down"] =  -1
cumulative_vec[cumulative_vec ==  "No-change"] =  0
cumulative_vec <- as.integer(cumulative_vec)
cumulative_vec <- cumsum(as.integer(cumulative_vec)) 
  

plot(seq(0, n_steps, 1),cumulative_vec, type = "s", col = "brown", xlab = "Steps", ylab = "Positions")

}
set.seed(123)
par(mfrow = c(2,3), mar = c(1,1,1,1), oma = c(2,2,2,2), main = "Simulated Paths")
for(i in 1:6){
  simulate_markov(tran_matrix[[2]], tran_matrix[[4]], states, n_steps = 1000)
  i = i + 1
}
```

## Increment Analysis

Since the Markov model does not provide information about the magnitude of the share price changes, I employed the concept of **ergodic stationarity** to analyze whether there is a drift in the increment. This section evaluates the tendency of the share price to move in one direction ("Up" or "Down"), complementing the insights from the Markov model.

To begin, it is essential to ensure that the increment of the share price is both stationary and ergodic. For the stationarity test, I utilized the **Augmented Dickey-Fuller (ADF) test**, which checks for the presence of a unit root in the time series. For testing ergodicity, I examined the graph of the **Auto-correlation Function (ACF) in R** to observe if there is an auto-correlation in the increment, and if there is whether the auto-correlations become statistically insignificant after a certain lag, $k$. This would indicate that the increment loses dependence over time, fulfilling the ergodicity condition provided it is stationary.

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
outlier_removal <-  function(stock_data, plot = FALSE, lower_bond = -40, upper_bond = 40){

  increments <- diff(stock_data)
  
  if(plot == TRUE){
    par(mfrow = c(2,1) , mar = c(2,2,2,2))
    plot(increments, type = "l", col = "brown", main = "Increments with outliers")
  }

# # IQR method
#   quartile <- quantile(increments, probs = c(0.25,0.75))
#   upper_bond <- quartile[2] + (3 * IQR(increments))
#   lower_bond <- quartile[1] - (3 * IQR(increments))

  increments <- increments[increments <= upper_bond & increments >= lower_bond]
  
  
  if(plot ==  TRUE){
    plot(increments, type = "l", col = "brown", main = "Increments without outliers")
  } 
  
  return(increments)
}

incre_out <- outlier_removal(jub_data, plot = TRUE)

```

The outliers were manually detected to preserve the natural volatility in the share price increment. Statistical methods were not ideal in this case, as they were too aggressive in identifying outliers, often removing persistent volatility, which is an important characteristic of the share price increment.

\textcolor{red}{Test outputs}

> **Augmented Dickey-Fuller Test**
>
> -   **Data**: ts(share_increment)
> -   **Test Statistic**: $-18.746$
> -   **Lag Order**: $10$
> -   **P-value**: $0.1$
> -   **Alternative Hypothesis**: The time series is stationary.
>
> **Test result:**
>
> Since the p-value ($0.1$) is less than the commonly used significance level ($0.05$), we reject the null hypothesis that the time series has a unit root. This indicates that the increment of the share price is **stationary**.

Below is the graph of the **Autocorrelation Function (ACF)** function in $\mathbf{R}$.

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
outlier_removal <-  function(stock_data, plot = FALSE, lower_bond = -40, upper_bond = 40){

  increments <- diff(stock_data)
  
  if(plot == TRUE){
    par(mfrow = c(2,1) , mar = c(2,2,2,2))
    plot(increments, type = "l", col = "brown", main = "Increment with outliers")
  }

# # IQR method
#   quartile <- quantile(increments, probs = c(0.25,0.75))
#   upper_bond <- quartile[2] + (3 * IQR(increments))
#   lower_bond <- quartile[1] - (3 * IQR(increments))

  increments <- increments[increments <= upper_bond & increments >= lower_bond]
  
  
  if(plot ==  TRUE){
    plot(increments, type = "l", col = "brown", main = "Increment without outliers - stationary")
  } 
  
  return(increments)
}

incre_out <- outlier_removal(jub_data, plot = FALSE)
acf(incre_out, lag.max = 10, main = "Increments Auto-Correlation")

```

> The Auto-Correlation Function (ACF) graph displays the autocorrelation in the data for lags ranging from $0 \;\text{to}\; 10$. The vertical lines represent the strength of the autocorrelation at each lag. If the line lies within the two horizontal dotted lines (representing the $95\%$ confidence interval), it means the autocorrelation is statistically insignificant under the null hypothesis that the autocorrelation is $0$. From the ACF graph, we can see that the autocorrelation is statistically insignificant starting from lag 2 and onwards. This means that the increment is only significantly correlated with its immediate past ($\text{lag}\;1$), suggesting short-term dependencies but no significant autocorrelation beyond the first lag.

Since we have now verified the increment of the share price is stationary, ergodic and significantly correlated with its immediate lag, we can now use the **Time Estimators** to check if there is a drift in the increment.

> -   Increments mean: 0.072
> -   Increments Variance: 50.482

The estimate of the ensemble mean is 0.072, which is approximately 0. We can further hypothesize that the ensemble mean is zero. This hypothesis will be tested using the **Z-test**, based on the assumption that the sample mean follows a normal distribution due to the **Central Limit Theorem (CLT)**. Because the sample size is large, we rely on the CLT to approximate the distribution of the sample mean to be approximately normal, with the population mean (ensemble mean) assumed to be zero.

\textcolor{red}{Test outputs}

> #### Z-test
>
> -   **Null Hypothesis (H₀):** The population mean is 0.
> -   **Alternative Hypothesis (H₁):** The population mean is not 0 (two-tailed test).
> -   **Sample Size (** $n$ **)**: 3713
> -   **Z-statistic:** 0.617
> -   **Z-critical value (95% confidence):** ±1.96
> -   **P-value:** 0.538
>
> #### Test result:
>
> The Z-statistic (0.617) lies within the critical range of ±1.96, and the P-value (0.538) is greater than the significance level of 0.05. Therefore, we **fail to reject the null hypothesis**.

**Discussion (Increment analysis)**

In a stationary process with no drift, the process tends to fluctuate symmetrically around a mean of zero. Such processes often exhibit cyclical variation, and when the process has weak autocorrelation and long-term independence, it may resemble an independent and identically distributed (iid) process, especially over long time periods. Since the drift (ensemble mean) is zero, the process will evolve symmetrically around zero, with fluctuations primarily due to random noise. These fluctuations will average out over time, thanks to the Central Limit Theorem (CLT).

Given this, we should not expect any significant directional movement, whether positive or negative, in the long run. The increments will be symmetric around zero, and there will be no inherent trend or constant shift in either direction. Thus, the process will remain concentrated around its mean, with deviations tending to be of similar magnitude, neither consistently increasing nor decreasing over time. Although rare, it is possible for a stochastic process with no drift to temporarily enter a state where directional trends are observed.

Below is the observed distribution of the increments, which should help verify the behavior around the mean, inferred to be 0.

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE}
generate_returns_dist <- function(stock_increments){
  increments <- stock_increments
  
  #Freedman-Diaconis rule
  bin_width <- 2 * (IQR(increments)/(length(increments))**(1/3))
  number_bins <- (range(increments)[2] - range(increments)[1])/bin_width
  number_bins <-  ceiling(number_bins)
  
  hist(increments, breaks = number_bins, xlim = c(min(increments),max(increments)), xlab = "Increments", main = "Distribution of the observed stationary increments")
}
generate_returns_dist(incre_out)

```

# Conclusion

The objective of this paper was to analyze the long-term behavior of Jubilee Holdings Limited's share price using a Markov model to describe transitions and the concept of ergodic stationarity to examine the increment. The findings from the Markov model reveal that the share price has a **31.2% chance of transitioning upward**, a **30% chance of transitioning downward**, and a **38.8% chance of remaining unchanged** in the long-run.

The analysis of increment further suggests that the ensemble mean of the increment is zero, a hypothesis supported by the Z-test. This indicates that there is no drift in the share price increment, meaning the price lacks a tendency to trend in either an upward or downward direction. Consequently, the share price is expected to remain stable in the long run, with no significant directional movement .This highlights the small difference between the probabilities of the share price going up or down in the long-run, as indicated by the Markov model, suggesting they are almost equally likely, with neither side showing real dominance.

These findings suggest that Jubilee Holdings Limited's share price may not be particularly attractive for investors seeking capital gains, as there is no statistical evidence for a potential sustained upward price movement. However, it is important to note that the inefficiency of the Kenya Securities Market could mean that share price behavior may not fully reflect the company’s performance.

It is also worth emphasizing that this analysis pertains strictly to capital gains. Despite the lack of significant price movement, Jubilee Holdings Limited has demonstrated consistent dividend payments over the past few years, which may make it a valuable investment for income-focused investors.

\textcolor{red}{Note:} This text assumes that the market conditions reflected in the data remain constant. This does not imply that the market is stationary, as the data also capture persistence and patterns of change. These variations are considered acceptable. However, any unusual events or deviations from the conditions observed during the studied period may contradict the findings presented here.

# References

Simeyo, Otieno & Otumba, Edgar & Nyabwanga, Robert. (2014). APPLICATION OF MARKOV CHAIN TO MODEL AND FORECAST STOCK MARKET TREND: A STUDY OF SAFARICOM SHARES IN NAIROBI SECURITIES EXCHANGE, KENYA. International Journal of Current Research. 7. 4712-14721.

Kiplangat, Dennis. (2024). Modelling selected stock prices at the Nairobi securities exchange using Markov chains. International Journal of Science and Research Archive. 13. 1528-1542. 10.30574/ijsra.2024.13.2.2294.

Tibshirani, R. (2023). *ARIMA Models*. Retrieved from <https://www.stat.berkeley.edu/~ryantibs/timeseries-f23/lectures/arima.pdf>
